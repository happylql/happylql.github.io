(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{341:function(t,v,_){t.exports=_.p+"assets/img/webRTC.649801c2.png"},378:function(t,v,_){"use strict";_.r(v);var s=_(0),a=Object(s.a)({},(function(){var t=this,v=t.$createElement,s=t._self._c||v;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("div",{staticClass:"custom-block tip"},[s("p",[t._v("最近遇到了一个要在 H5 上进行实时直播的需求，但移动端 Web 没了 Flash。本文给出我的一些思路和建议。")])]),t._v(" "),s("h2",{attrs:{id:"缘由"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#缘由"}},[t._v("#")]),t._v(" 缘由")]),t._v(" "),s("ul",[s("li",[t._v("1）移动浏览器全面禁止 flash，当前 H5 播放器不支持可用于实时直播的 rtmp 协议；")]),t._v(" "),s("li",[t._v("2）http-flv 协议可用于实时直播，仅部分浏览器支持（ios 浏览器全部不支持，前端使用 flv.js）；")]),t._v(" "),s("li",[t._v("3）hls 协议可用于直播，但其实是使用点播的方式实现直播。它喂给客户端是分片文件，而非直播流。")])]),t._v(" "),s("h2",{attrs:{id:"知识点"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#知识点"}},[t._v("#")]),t._v(" 知识点")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("1）国内常见的直播协议")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("协议")]),t._v(" "),s("th",[t._v("原理")]),t._v(" "),s("th",[t._v("播放器")]),t._v(" "),s("th",[t._v("延时")]),t._v(" "),s("th",[t._v("兼容")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("RTMP")]),t._v(" "),s("td",[t._v("每个时刻的数据收到后立即转发")]),t._v(" "),s("td",[t._v("flash")]),t._v(" "),s("td",[t._v("1~3s")]),t._v(" "),s("td",[t._v("需要 flash 播放，H5 上依赖第三方插件")])]),t._v(" "),s("tr",[s("td",[t._v("HLS")]),t._v(" "),s("td",[t._v("集合一段时间的数据，生成 ts 切片文件，播完一个列表的 ts 文件再更新下一个列表")]),t._v(" "),s("td",[s("code",[t._v("<video>")])]),t._v(" "),s("td",[t._v("5~20s")]),t._v(" "),s("td",[t._v("H5 上直接可播放")])]),t._v(" "),s("tr",[s("td",[t._v("HTTP-FLV")]),t._v(" "),s("td",[t._v("同 RTMP")]),t._v(" "),s("td",[s("code",[t._v("<video>")])]),t._v(" "),s("td",[t._v("1~3s")]),t._v(" "),s("td",[t._v("依赖第三方插件，IOS 无法播放")])])])])]),t._v(" "),s("li",[s("p",[t._v("2）HLS 延时高的原因\n要生成切片才能推送数据，如果每个 ts 按照 5 秒来切分，一个 m3u8 放 6 个 ts 索引，那么至少就会带来 30 秒的延迟。如果减少每个 ts 的长度，减少 m3u8 中的索引数，延时确实会减少，但会带来更频繁的缓冲，对服务端的请求压力也会成倍增加。所以只能根据实际情况找到一个折中的点。")])])]),t._v(" "),s("h2",{attrs:{id:"思路"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#思路"}},[t._v("#")]),t._v(" 思路")]),t._v(" "),s("ul",[s("li",[t._v("1）服务端方向：\n很容易想到 hls 协议采用更短时长的分片和更少的分片文件传输，但是 "),s("a",{attrs:{href:"https://www.jianshu.com/p/76696e0bf62f",target:"_blank",rel:"noopener noreferrer"}},[t._v("hls 切片和 rtmp 视频源的 gop 有关"),s("OutboundLink")],1),t._v("。不管如何实现，延迟肯定还是很高，不适合做实时性要求高的直播；")]),t._v(" "),s("li",[t._v("2）服务端+客户端方向：\n使用 webRTC 方式转发直播流，实现较为复杂，比如搭建信令服务器、p2p 穿透等；")]),t._v(" "),s("li",[t._v("3）客户端方向：\n类似 NodePlayer.js 一样实现一个 H5 视频播放器插件，但是需要掌握音视频开发相关知识，起点较高；")])]),t._v(" "),s("h2",{attrs:{id:"建议"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#建议"}},[t._v("#")]),t._v(" 建议")]),t._v(" "),s("ul",[s("li",[t._v("1）不考虑浏览器的兼容问题，选用 http-flv，预计用时：1 周以内，难度系数：0.5。")]),t._v(" "),s("li",[t._v("2）webRTC 可以做到更低的延迟，但是技术实现较为复杂，时间充裕情况下，可以考虑；预计用时：2 周以上，难度系数：0.8；")]),t._v(" "),s("li",[t._v("3）有钱也可以使用 NodePlayer.js，5000 大洋一个顶级域名；源码文件编译为 WebAssembly（web 端汇编语言）格式，难以破解。")])]),t._v(" "),s("h2",{attrs:{id:"附件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#附件"}},[t._v("#")]),t._v(" 附件")]),t._v(" "),s("ul",[s("li",[t._v("i.webRTC 的兼容性\n"),s("img",{attrs:{src:_(341),alt:"WebRTC 的兼容性"}})])])])}),[],!1,null,null,null);v.default=a.exports}}]);